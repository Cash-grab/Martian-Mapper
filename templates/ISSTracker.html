{% extends "base.html" %}
{% block head %}
    <title>Internatinal space station tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
     <style>
.mapContainer {
    width: 95vw;
    max-width: 800px;
    margin: 3vh auto 0 auto;
    border: 2px solid #000;
    border-radius: 8px;
    box-shadow: #fff 1px 1px 2px, #fff 0 0 25px, #fff 0 0 5px;
    overflow: hidden;
}

#map {
    width: 100%;
    height: 50vw;
    max-height: 400px;
    min-height: 250px;
}

@media (max-width: 600px) {
    .mapContainer {
        width: 99vw;
        max-width: 100vw;
        border-radius: 0;
    }
    #map {
        height: 60vw;
        min-height: 200px;
        max-height: 300px;
    }
}

.introContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    margin: auto;
    margin-top: 10px;
    color: #c1440e;
    gap: 10px;
}
.mainHeading {
    text-shadow: #000 1px 1px 2px, #000 0 0 25px, #000 0 0 5px;
}
.subheading {
    text-shadow: #000 1px 1px 2px, #000 0 0 25px, #000 0 0 5px;
    margin: auto;
    color: #ffde59;
}
    </style>
{% endblock %}
{% block content %}
    <div class="introContainer">
        <h1 class="mainHeading">Welcome to this cool little map which tracks~</h1>
        <h2 class="subheading">International space station!</h2>
    </div>
    <div class="mapContainer">
        <div id="map"></div>
    </div>
{% endblock %}
{% block scriptTags%}
 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script>
    var map = L.map('map').setView([0, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    var issIcon = L.icon({
        iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/d/d0/International_Space_Station.svg',
        iconSize: [50, 32],
        iconAnchor: [25, 16]
    });

    var issMarker = L.marker([0, 0], {icon: issIcon}).addTo(map);

    async function fetchISSData() {
        const response = await fetch('http://api.open-notify.org/iss-now.json');
        const data = await response.json();
        const { latitude, longitude } = data.iss_position;
        return [parseFloat(latitude), parseFloat(longitude)];
    }

    async function updateISSPosition() {
        const [lat, lon] = await fetchISSData();
        issMarker.setLatLng([lat, lon]);
        map.setView([lat, lon], map.getZoom());
    }

    setInterval(updateISSPosition, 5000);
    updateISSPosition();
</script>
{% endblock %}